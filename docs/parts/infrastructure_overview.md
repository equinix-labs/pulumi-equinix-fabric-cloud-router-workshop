<!-- See https://squidfunk.github.io/mkdocs-material/reference/ -->
# Part 3: Infrastructure Overview

Now that we have successfully configured and provisioned our infrastructure using Pulumi, let's take a closer look at the components we deployed and their functionalities.

## Resources

### 1. Equinix Fabric Cloud Router (FCR):

The Equinix Fabric Cloud Router is an on-demand, easy-to-deploy virtual routing service on Equinix Fabric that establishes flexible, private Layer 3 connectivity between public clouds, collocation, and other Equinix services across our software-defined global network. With these features, you can route traffic across your multicloud network more efficiently and at scale to achieve optimal performance, security, and control.

### 2. Equinix Fabric Connection to Google Cloud Platform (GCP):

Leveraging Equinix Fabric's direct and private interconnection capabilities, we established a secure connection from our Equinix infrastructure to Google Cloud Platform (GCP). This private connection ensures low-latency and high-bandwidth connectivity, ideal for mission-critical workloads and data transfer between our Equinix environment and GCP services.

### 3. Google Cloud Router:

In addition to the Equinix Fabric Cloud Router, we deployed a Google Cloud Router within GCP. The Google Cloud Router is responsible for dynamically exchanging routing information with our Equinix Fabric Cloud Router via the Border Gateway Protocol (BGP). This dynamic routing enables efficient traffic routing and ensures seamless connectivity between our Equinix infrastructure and resources hosted on GCP.

### 4. Google Cloud VLAN Attachment (Interconnect):

To facilitate the private connection between our Equinix infrastructure and GCP, we established a VLAN attachment (Interconnect) within GCP. This VLAN attachment serves as the physical link between our Equinix Fabric Cloud Router and the Google Cloud Router, allowing for high-speed and reliable data transfer between the two environments.

### 5. Equinix Fabric Routing Protocol:

Our Pulumi template includes networking configurations that govern the communication pathways and traffic flow within our infrastructure. This includes settings such as IP addressing, peering, BGP and ASN. BGP is a dynamic routing protocol that enables the exchange of routing information between autonomous systems, ensuring optimal path selection and routing efficiency across our interconnected network.

### 5. CloudRouterPeerConfig ([Custom Pulumi Component Resource](https://www.pulumi.com/docs/concepts/resources/components/#component-resources)):

In addition to the infrastructure components mentioned earlier, we have also implemented a custom Pulumi Component Resource to extend the functionality of the Google Cloud Platform (GCP) provider. This custom resource addresses a specific limitation in the GCP provider related to Partner Interconnect Connections and the automatic creation of BGP sessions in Google Cloud Router.

- Purpose and Functionality:

The custom Pulumi Component Resource has been developed to automate the configuration of BGP peer parameters, specifically the Partner ASN, in Google Cloud Router. When setting up a Partner Interconnect Connection with GCP, the BGP session is automatically created in the Google Cloud Router. However, the RouterPeer resource available in the classic GCP Pulumi provider does not support updating autogenerated configurations.

- Implementation Approach:

To address this limitation, we opted to implement a custom Pulumi Component Resource using the Google Python SDK. By leveraging the SDK, we gain granular control over the BGP peer configuration and can programmatically update the autogenerated parameters, such as the Partner ASN, as part of the deployment process.

- Benefits of Component Resource:

Using a Component Resource instead of a standalone function provides several advantages. It allows us to encapsulate the logic for managing the lifecycle of the custom resource within our Pulumi project. This includes handling resource creation, updates, and deletion, ensuring consistent behavior and reliability throughout the deployment process.

- Integration with Pulumi Workflow:

The custom Pulumi Component Resource seamlessly integrates with the overall Pulumi workflow, enabling automated deployment of the extended GCP functionality alongside other infrastructure components. This streamlines the provisioning process and ensures that the BGP peer parameters are correctly configured without manual intervention.


## Discussion

Before proceeding to the next part let's take a few minutes to discuss what we did. Here are some questions to start the discussion.

* How would you design the infrastructure to achieve high availability and redundancy, minimizing the risk of downtime or service disruptions?
* Beyond Google Cloud Platform, are there any other cloud providers or services you envision integrating with the Equinix infrastructure in the future?
